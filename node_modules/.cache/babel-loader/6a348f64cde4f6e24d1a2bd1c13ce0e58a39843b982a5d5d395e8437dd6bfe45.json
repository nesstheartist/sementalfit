{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\nessc\\\\Semental fit ultima\\\\sementalfit2\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile, GoogleAuthProvider, signInWithPopup } from 'firebase/auth';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport { db } from '../firebase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport function useAuth() {\n  _s();\n  return useContext(AuthContext);\n}\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const [currentUser, setCurrentUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const auth = getAuth();\n  const googleProvider = new GoogleAuthProvider();\n  async function login(email, password) {\n    try {\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\n      const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));\n      if (!userDoc.exists()) {\n        throw new Error('Usuario no encontrado en la base de datos');\n      }\n      const userData = userDoc.data();\n      if (userData.status === 'blocked') {\n        await signOut(auth);\n        throw new Error('Usuario bloqueado');\n      }\n      return userCredential;\n    } catch (error) {\n      throw error;\n    }\n  }\n  async function register(email, password, name, role = 'user') {\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n\n      // Crear documento de usuario en Firestore\n      await setDoc(doc(db, 'users', userCredential.user.uid), {\n        email,\n        name,\n        role,\n        createdAt: new Date().toISOString(),\n        lastLogin: new Date().toISOString(),\n        status: 'active'\n      });\n\n      // Actualizar perfil de Firebase Auth\n      await updateProfile(userCredential.user, {\n        displayName: name\n      });\n      return userCredential;\n    } catch (error) {\n      throw error;\n    }\n  }\n  async function logout() {\n    try {\n      await signOut(auth);\n    } catch (error) {\n      throw error;\n    }\n  }\n  async function loginWithGoogle() {\n    try {\n      const result = await signInWithPopup(auth, googleProvider);\n      const user = result.user;\n\n      // Verificar si el usuario ya existe en Firestore\n      const userDoc = await getDoc(doc(db, 'users', user.uid));\n      if (!userDoc.exists()) {\n        // Si es un nuevo usuario, crear su documento en Firestore\n        await setDoc(doc(db, 'users', user.uid), {\n          email: user.email,\n          name: user.displayName,\n          role: 'user',\n          createdAt: new Date().toISOString(),\n          lastLogin: new Date().toISOString(),\n          status: 'active',\n          photoURL: user.photoURL\n        });\n      } else {\n        // Si el usuario existe, verificar si está bloqueado\n        const userData = userDoc.data();\n        if (userData.status === 'blocked') {\n          await signOut(auth);\n          throw new Error('Usuario bloqueado');\n        }\n      }\n      return result;\n    } catch (error) {\n      throw error;\n    }\n  }\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async user => {\n      if (user) {\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\n        if (userDoc.exists()) {\n          setCurrentUser({\n            ...user,\n            ...userDoc.data()\n          });\n        }\n      } else {\n        setCurrentUser(null);\n      }\n      setLoading(false);\n    });\n    return unsubscribe;\n  }, [auth]);\n  const value = {\n    currentUser,\n    login,\n    register,\n    logout,\n    loginWithGoogle,\n    loading\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 9\n  }, this);\n}\n_s2(AuthProvider, \"+Bt7EujFHjK6mRV3YX1iAtSqXvQ=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","getAuth","onAuthStateChanged","signInWithEmailAndPassword","createUserWithEmailAndPassword","signOut","updateProfile","GoogleAuthProvider","signInWithPopup","doc","getDoc","setDoc","db","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","currentUser","setCurrentUser","loading","setLoading","auth","googleProvider","login","email","password","userCredential","userDoc","user","uid","exists","Error","userData","data","status","error","register","name","role","createdAt","Date","toISOString","lastLogin","displayName","logout","loginWithGoogle","result","photoURL","unsubscribe","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/nessc/Semental fit ultima/sementalfit2/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { \r\n    getAuth, \r\n    onAuthStateChanged, \r\n    signInWithEmailAndPassword,\r\n    createUserWithEmailAndPassword,\r\n    signOut,\r\n    updateProfile,\r\n    GoogleAuthProvider,\r\n    signInWithPopup\r\n} from 'firebase/auth';\r\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const auth = getAuth();\r\n    const googleProvider = new GoogleAuthProvider();\r\n\r\n    async function login(email, password) {\r\n        try {\r\n            const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n            const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));\r\n            \r\n            if (!userDoc.exists()) {\r\n                throw new Error('Usuario no encontrado en la base de datos');\r\n            }\r\n\r\n            const userData = userDoc.data();\r\n            if (userData.status === 'blocked') {\r\n                await signOut(auth);\r\n                throw new Error('Usuario bloqueado');\r\n            }\r\n\r\n            return userCredential;\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async function register(email, password, name, role = 'user') {\r\n        try {\r\n            const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n            \r\n            // Crear documento de usuario en Firestore\r\n            await setDoc(doc(db, 'users', userCredential.user.uid), {\r\n                email,\r\n                name,\r\n                role,\r\n                createdAt: new Date().toISOString(),\r\n                lastLogin: new Date().toISOString(),\r\n                status: 'active'\r\n            });\r\n\r\n            // Actualizar perfil de Firebase Auth\r\n            await updateProfile(userCredential.user, {\r\n                displayName: name\r\n            });\r\n\r\n            return userCredential;\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async function logout() {\r\n        try {\r\n            await signOut(auth);\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async function loginWithGoogle() {\r\n        try {\r\n            const result = await signInWithPopup(auth, googleProvider);\r\n            const user = result.user;\r\n            \r\n            // Verificar si el usuario ya existe en Firestore\r\n            const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n            \r\n            if (!userDoc.exists()) {\r\n                // Si es un nuevo usuario, crear su documento en Firestore\r\n                await setDoc(doc(db, 'users', user.uid), {\r\n                    email: user.email,\r\n                    name: user.displayName,\r\n                    role: 'user',\r\n                    createdAt: new Date().toISOString(),\r\n                    lastLogin: new Date().toISOString(),\r\n                    status: 'active',\r\n                    photoURL: user.photoURL\r\n                });\r\n            } else {\r\n                // Si el usuario existe, verificar si está bloqueado\r\n                const userData = userDoc.data();\r\n                if (userData.status === 'blocked') {\r\n                    await signOut(auth);\r\n                    throw new Error('Usuario bloqueado');\r\n                }\r\n            }\r\n\r\n            return result;\r\n        } catch (error) {\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n            if (user) {\r\n                const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n                if (userDoc.exists()) {\r\n                    setCurrentUser({\r\n                        ...user,\r\n                        ...userDoc.data()\r\n                    });\r\n                }\r\n            } else {\r\n                setCurrentUser(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        return unsubscribe;\r\n    }, [auth]);\r\n\r\n    const value = {\r\n        currentUser,\r\n        login,\r\n        register,\r\n        logout,\r\n        loginWithGoogle,\r\n        loading\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {!loading && children}\r\n        </AuthContext.Provider>\r\n    );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}